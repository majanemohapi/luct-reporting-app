{"ast":null,"code":"import React,{useState,useEffect}from'react';import axios from'axios';import{Pie}from'react-chartjs-2';import{Chart as ChartJS,ArcElement,Tooltip,Legend}from'chart.js';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";ChartJS.register(ArcElement,Tooltip,Legend);const Reports=()=>{const[reports,setReports]=useState([]);const[feedback,setFeedback]=useState({});const[searchQuery,setSearchQuery]=useState('');const[chartData,setChartData]=useState({});const token=localStorage.getItem('token');const headers={Authorization:\"Bearer \".concat(token)};useEffect(()=>{fetchReports();},[]);const fetchReports=()=>{axios.get('/api/reports',{headers}).then(res=>{setReports(res.data);prepareChartData(res.data);}).catch(err=>alert('Failed to fetch reports'));};const handleSearch=async()=>{try{const res=await axios.get(\"/api/search/reports?query=\".concat(searchQuery),{headers});setReports(res.data);prepareChartData(res.data);}catch(_unused){alert('Search failed');}};// Prepare data for pie chart, e.g., by lecturer\nconst prepareChartData=reportsData=>{const categoryCounts={};reportsData.forEach(r=>{const category=r.lecturer_name;categoryCounts[category]=(categoryCounts[category]||0)+1;});const labels=Object.keys(categoryCounts);const data=Object.values(categoryCounts);setChartData({labels,datasets:[{label:'Reports by Lecturer',data,backgroundColor:['rgba(255, 99, 132, 0.6)','rgba(54, 162, 235, 0.6)','rgba(255, 206, 86, 0.6)','rgba(75, 192, 192, 0.6)','rgba(153, 102, 255, 0.6)','rgba(255, 159, 64, 0.6)'],borderColor:'rgba(255, 255, 255, 1)',borderWidth:1}]});};return/*#__PURE__*/_jsxs(\"div\",{className:\"container mt-5\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Reports\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search reports...\",className:\"form-control\",value:searchQuery,onChange:e=>setSearchQuery(e.target.value)}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSearch,className:\"btn btn-secondary mt-2\",children:\"Search\"})]}),/*#__PURE__*/_jsxs(\"table\",{className:\"table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"ID\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Week\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Lecturer\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Topic\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Feedback\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:reports.map(report=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:report.id}),/*#__PURE__*/_jsx(\"td\",{children:report.week}),/*#__PURE__*/_jsx(\"td\",{children:report.date}),/*#__PURE__*/_jsx(\"td\",{children:report.lecturer_name}),/*#__PURE__*/_jsx(\"td\",{children:report.topic_taught}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control\",value:feedback[report.id]||report.prl_feedback||'',onChange:e=>handleFeedbackChange(report.id,e.target.value)})}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleAddFeedback(report.id),className:\"btn btn-sm btn-primary\",children:\"Add Feedback\"}),/*#__PURE__*/_jsx(\"a\",{href:\"/api/reports/\".concat(report.id,\"/excel\"),className:\"btn btn-sm btn-info mx-2\",children:\"Download\"})]})]},report.id))})]}),/*#__PURE__*/_jsx(\"h4\",{className:\"mt-5\",children:\"Distribution of Reports by Lecturer\"}),chartData.labels&&chartData.labels.length>0?/*#__PURE__*/_jsx(\"div\",{style:{maxWidth:'500px',margin:'0 auto'},children:/*#__PURE__*/_jsx(Pie,{data:chartData,options:{responsive:true,plugins:{legend:{position:'bottom'},title:{display:true,text:'Reports Distribution by Lecturer'}}}})}):/*#__PURE__*/_jsx(\"p\",{children:\"No chart data available.\"})]});};export default Reports;","map":{"version":3,"names":["React","useState","useEffect","axios","Pie","Chart","ChartJS","ArcElement","Tooltip","Legend","jsx","_jsx","jsxs","_jsxs","register","Reports","reports","setReports","feedback","setFeedback","searchQuery","setSearchQuery","chartData","setChartData","token","localStorage","getItem","headers","Authorization","concat","fetchReports","get","then","res","data","prepareChartData","catch","err","alert","handleSearch","_unused","reportsData","categoryCounts","forEach","r","category","lecturer_name","labels","Object","keys","values","datasets","label","backgroundColor","borderColor","borderWidth","className","children","type","placeholder","value","onChange","e","target","onClick","map","report","id","week","date","topic_taught","prl_feedback","handleFeedbackChange","handleAddFeedback","href","length","style","maxWidth","margin","options","responsive","plugins","legend","position","title","display","text"],"sources":["C:/Users/BRAINTECH/Desktop/majane/majane/luct-report/luct-reporting-app/frontend/src/components/prl/Reports.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport { Pie } from 'react-chartjs-2';\r\n\r\n\r\nimport {\r\n  Chart as ChartJS,\r\n  ArcElement,\r\n  Tooltip,\r\n  Legend\r\n} from 'chart.js';\r\n\r\nChartJS.register(ArcElement, Tooltip, Legend);\r\n\r\nconst Reports = () => {\r\n  const [reports, setReports] = useState([]);\r\n  const [feedback, setFeedback] = useState({});\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [chartData, setChartData] = useState({});\r\n  const token = localStorage.getItem('token');\r\n  const headers = { Authorization: `Bearer ${token}` };\r\n\r\n  useEffect(() => {\r\n    fetchReports();\r\n  }, []);\r\n\r\n  const fetchReports = () => {\r\n    axios.get('/api/reports', { headers })\r\n      .then(res => {\r\n        setReports(res.data);\r\n        prepareChartData(res.data); \r\n      })\r\n      .catch(err => alert('Failed to fetch reports'));\r\n  };\r\n\r\n  const handleSearch = async () => {\r\n    try {\r\n      const res = await axios.get(`/api/search/reports?query=${searchQuery}`, { headers });\r\n      setReports(res.data);\r\n      prepareChartData(res.data); \r\n    } catch {\r\n      alert('Search failed');\r\n    }\r\n  };\r\n\r\n  // Prepare data for pie chart, e.g., by lecturer\r\n  const prepareChartData = (reportsData) => {\r\n    const categoryCounts = {};\r\n    reportsData.forEach(r => {\r\n      const category = r.lecturer_name;\r\n      categoryCounts[category] = (categoryCounts[category] || 0) + 1;\r\n    });\r\n    const labels = Object.keys(categoryCounts);\r\n    const data = Object.values(categoryCounts);\r\n    setChartData({\r\n      labels,\r\n      datasets: [\r\n        {\r\n          label: 'Reports by Lecturer',\r\n          data,\r\n          backgroundColor: [\r\n            'rgba(255, 99, 132, 0.6)',\r\n            'rgba(54, 162, 235, 0.6)',\r\n            'rgba(255, 206, 86, 0.6)',\r\n            'rgba(75, 192, 192, 0.6)',\r\n            'rgba(153, 102, 255, 0.6)',\r\n            'rgba(255, 159, 64, 0.6)'\r\n          ],\r\n          borderColor: 'rgba(255, 255, 255, 1)',\r\n          borderWidth: 1\r\n        }\r\n      ]\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"container mt-5\">\r\n      <h3>Reports</h3>\r\n      <div className=\"mb-3\">\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Search reports...\"\r\n          className=\"form-control\"\r\n          value={searchQuery}\r\n          onChange={(e) => setSearchQuery(e.target.value)}\r\n        />\r\n        <button onClick={handleSearch} className=\"btn btn-secondary mt-2\">Search</button>\r\n      </div>\r\n\r\n      {/* Reports Table */}\r\n      <table className=\"table\">\r\n        <thead>\r\n          <tr>\r\n            <th>ID</th>\r\n            <th>Week</th>\r\n            <th>Date</th>\r\n            <th>Lecturer</th>\r\n            <th>Topic</th>\r\n            <th>Feedback</th>\r\n            <th>Actions</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {reports.map(report => (\r\n            <tr key={report.id}>\r\n              <td>{report.id}</td>\r\n              <td>{report.week}</td>\r\n              <td>{report.date}</td>\r\n              <td>{report.lecturer_name}</td>\r\n              <td>{report.topic_taught}</td>\r\n              <td>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"form-control\"\r\n                  value={feedback[report.id] || report.prl_feedback || ''}\r\n                  onChange={(e) => handleFeedbackChange(report.id, e.target.value)}\r\n                />\r\n              </td>\r\n              <td>\r\n                <button onClick={() => handleAddFeedback(report.id)} className=\"btn btn-sm btn-primary\">Add Feedback</button>\r\n                <a href={`/api/reports/${report.id}/excel`} className=\"btn btn-sm btn-info mx-2\">Download</a>\r\n              </td>\r\n            </tr>\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n\r\n      {/* Pie Chart */}\r\n      <h4 className=\"mt-5\">Distribution of Reports by Lecturer</h4>\r\n      {chartData.labels && chartData.labels.length > 0 ? (\r\n        <div style={{ maxWidth: '500px', margin: '0 auto' }}>\r\n          <Pie data={chartData} options={{\r\n            responsive: true,\r\n            plugins: {\r\n              legend: { position: 'bottom' },\r\n              title: {\r\n                display: true,\r\n                text: 'Reports Distribution by Lecturer'\r\n              }\r\n            }\r\n          }} />\r\n        </div>\r\n      ) : (\r\n        <p>No chart data available.</p>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Reports;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}